import React, { useState, useRef } from 'react';
import { useReactToPrint } from 'react-to-print';
import * as docx from 'docx-preview';
import { saveAs } from 'file-saver';
import { pdf } from '@react-pdf/renderer';

// Estilos CSS
const styles = {
  container: {
    maxWidth: '1200px',
    margin: '0 auto',
    padding: '20px',
    fontFamily: 'Arial, sans-serif',
  },
  header: {
    textAlign: 'center',
    marginBottom: '30px',
  },
  form: {
    marginBottom: '30px',
  },
  formSection: {
    marginBottom: '20px',
    padding: '15px',
    border: '1px solid #ddd',
    borderRadius: '5px',
  },
  sectionTitle: {
    marginBottom: '15px',
    borderBottom: '1px solid #eee',
    paddingBottom: '10px',
  },
  formGroup: {
    marginBottom: '15px',
  },
  label: {
    display: 'block',
    marginBottom: '5px',
    fontWeight: 'bold',
  },
  input: {
    width: '100%',
    padding: '8px',
    border: '1px solid #ddd',
    borderRadius: '4px',
    fontSize: '16px',
  },
  button: {
    padding: '10px 15px',
    backgroundColor: '#4a69bd',
    color: 'white',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontSize: '16px',
    marginRight: '10px',
  },
  documentPreview: {
    border: '1px solid #ddd',
    padding: '20px',
    minHeight: '500px',
    backgroundColor: 'white',
    marginBottom: '20px',
  },
  buttonContainer: {
    marginBottom: '20px',
  },
  fileInput: {
    marginBottom: '10px',
  },
  hidden: {
    display: 'none',
  },
};

// Templates disponíveis
const templates = {
  peticaoInicial: {
    nome: 'Petição Inicial',
    gerarDocumento: (dados) => {
      return `
        <div style="padding: 40px; font-family: Arial, sans-serif; line-height: 1.6;">
          ${dados.timbrePrevisualizacao ? `<div><img src="${dados.timbrePrevisualizacao}" style="max-width: 100%; height: auto;"/></div>` : ''}
          
          <div style="text-align: right;">
            ${dados.cidadeAdvogado}, ${new Date().toLocaleDateString('pt-BR')}
          </div>
          
          <h2 style="text-align: center; margin-top: 40px;">PETIÇÃO INICIAL</h2>
          
          <div style="margin-top: 40px;">
            <p>AO JUÍZO DA VARA CÍVEL DA COMARCA DE ${dados.cidadeCliente.toUpperCase()}</p>
          </div>
          
          <div style="margin-top: 60px; text-align: justify;">
            <p><strong>${dados.nomeCliente}</strong>, ${dados.nacionalidadeCliente}, ${dados.estadoCivilCliente}, portador do RG nº ${dados.rgCliente}, inscrito no CPF sob o nº ${dados.cpfCliente}, residente e domiciliado à ${dados.enderecoCliente}, vem, por seu advogado que esta subscreve, propor a presente:</p>
            
            <p style="text-align: center; margin: 30px 0;"><strong>AÇÃO DE [TIPO DA AÇÃO]</strong></p>
            
            <p>Em face de [NOME DO RÉU], [QUALIFICAÇÃO COMPLETA], pelos fatos e fundamentos a seguir expostos:</p>
            
            <h3 style="margin-top: 40px;">I - DOS FATOS</h3>
            <p>${dados.descricaoFatos}</p>
            
            <h3 style="margin-top: 40px;">II - DO DIREITO</h3>
            <p>[Fundamentos jurídicos da ação]</p>
            
            <h3 style="margin-top: 40px;">III - DOS PEDIDOS</h3>
            <p>${dados.pedidos}</p>
            
            <h3 style="margin-top: 40px;">IV - DAS PROVAS</h3>
            <p>Requer-se a produção de todas as provas em direito admitidas, especialmente [especificar as provas].</p>
            
            <h3 style="margin-top: 40px;">V - DO VALOR DA CAUSA</h3>
            <p>Dá-se à causa o valor de R$ ${dados.valorCausa}</p>
            
            <p style="margin-top: 60px;">Nestes termos,<br>Pede deferimento.</p>
            
            <div style="margin-top: 40px;">
              <p>${dados.cidadeAdvogado}, ${new Date().toLocaleDateString('pt-BR')}</p>
              <p style="margin-top: 40px; border-top: 1px solid #000; width: 250px; padding-top: 10px;">${dados.nomeAdvogado}<br>OAB/${dados.estadoAdvogado} ${dados.numeroOAB}</p>
            </div>
          </div>
        </div>
      `;
    }
  },
  contestacao: {
    nome: 'Contestação',
    gerarDocumento: (dados) => {
      return `
        <div style="padding: 40px; font-family: Arial, sans-serif; line-height: 1.6;">
          ${dados.timbrePrevisualizacao ? `<div><img src="${dados.timbrePrevisualizacao}" style="max-width: 100%; height: auto;"/></div>` : ''}
          
          <div style="text-align: right;">
            ${dados.cidadeAdvogado}, ${new Date().toLocaleDateString('pt-BR')}
          </div>
          
          <h2 style="text-align: center; margin-top: 40px;">CONTESTAÇÃO</h2>
          
          <div style="margin-top: 40px;">
            <p>AO JUÍZO DA VARA CÍVEL DA COMARCA DE ${dados.cidadeCliente.toUpperCase()}</p>
            <p>PROCESSO Nº: ${dados.numeroProcesso || '[NÚMERO DO PROCESSO]'}</p>
          </div>
          
          <div style="margin-top: 60px; text-align: justify;">
            <p><strong>${dados.nomeCliente}</strong>, já qualificado nos autos do processo em epígrafe, por seu advogado que esta subscreve, vem, respeitosamente, à presença de Vossa Excelência, apresentar:</p>
            
            <p style="text-align: center; margin: 30px 0;"><strong>CONTESTAÇÃO</strong></p>
            
            <p>Em face de [NOME DO AUTOR], pelos fatos e fundamentos a seguir expostos:</p>
            
            <h3 style="margin-top: 40px;">I - DOS FATOS</h3>
            <p>${dados.descricaoFatos}</p>
            
            <h3 style="margin-top: 40px;">II - DO DIREITO</h3>
            <p>[Fundamentos jurídicos da contestação]</p>
            
            <h3 style="margin-top: 40px;">III - DOS PEDIDOS</h3>
            <p>${dados.pedidos}</p>
            
            <p style="margin-top: 60px;">Nestes termos,<br>Pede deferimento.</p>
            
            <div style="margin-top: 40px;">
              <p>${dados.cidadeAdvogado}, ${new Date().toLocaleDateString('pt-BR')}</p>
              <p style="margin-top: 40px; border-top: 1px solid #000; width: 250px; padding-top: 10px;">${dados.nomeAdvogado}<br>OAB/${dados.estadoAdvogado} ${dados.numeroOAB}</p>
            </div>
          </div>
        </div>
      `;
    }
  }
};

function App() {
  // Estados para armazenar os dados do formulário
  const [formData, setFormData] = useState({
    // Dados do cliente
    nomeCliente: '',
    nacionalidadeCliente: '',
    estadoCivilCliente: '',
    profissaoCliente: '',
    rgCliente: '',
    cpfCliente: '',
    enderecoCliente: '',
    cidadeCliente: '',
    estadoCliente: '',
    cepCliente: '',
    
    // Dados do advogado
    nomeAdvogado: '',
    numeroOAB: '',
    estadoAdvogado: '',
    enderecoAdvogado: '',
    cidadeAdvogado: '',
    estadoEnderecoAdvogado: '',
    cepAdvogado: '',
    emailAdvogado: '',
    telefoneAdvogado: '',
    
    // Dados do processo
    templateSelecionado: 'peticaoInicial',
    descricaoFatos: '',
    pedidos: '',
    valorCausa: '',
    numeroProcesso: '',
    
    // Arquivo de timbre
    timbreArquivo: null,
    timbrePrevisualizacao: null,
  });
  
  // Estado para controlar se o documento foi gerado
  const [documentoGerado, setDocumentoGerado] = useState(false);
  // Referência para o componente de impressão
  const componenteImpressao = useRef();
  
  // Função para lidar com mudanças nos campos do formulário
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData({
      ...formData,
      [name]: value
    });
  };
  
  // Função para lidar com upload do timbre
  const handleTimbreUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        setFormData({
          ...formData,
          timbreArquivo: file,
          timbrePrevisualizacao: event.target.result
        });
      };
      reader.readAsDataURL(file);
    }
  };
  
  // Função para gerar o documento
  const gerarDocumento = () => {
    setDocumentoGerado(true);
  };
  
  // Função para imprimir o documento
  const handlePrint = useReactToPrint({
    content: () => componenteImpressao.current,
    documentTitle: `Processo_${formData.nomeCliente.replace(/\s+/g, '_')}`,
  });
  
  // Função para exportar como DOC (simulação básica)
  const exportarComoDoc = () => {
    const conteudoHTML = templates[formData.templateSelecionado].gerarDocumento(formData);
    const blob = new Blob([conteudoHTML], { type: 'application/msword' });
    saveAs(blob, `Processo_${formData.nomeCliente.replace(/\s+/g, '_')}.doc`);
  };
  
  // Função para exportar como PDF
  const exportarComoPdf = async () => {
    const conteudoHTML = templates[formData.templateSelecionado].gerarDocumento(formData);
    
    // Esta é uma implementação básica. Para uma solução completa, 
    // você precisaria de uma biblioteca como jsPDF ou react-pdf
    const blob = new Blob([conteudoHTML], { type: 'application/pdf' });
    saveAs(blob, `Processo_${formData.nomeCliente.replace(/\s+/g, '_')}.pdf`);
  };
  
  // Função para voltar ao formulário
  const voltarParaFormulario = () => {
    setDocumentoGerado(false);
  };

  return (
    <div style={styles.container}>
      <div style={styles.header}>
        <h1>Gerador de Processos Jurídicos</h1>
      </div>
      
      {!documentoGerado ? (
        <div style={styles.form}>
          <div style={styles.formSection}>
            <h2 style={styles.sectionTitle}>Template e Timbre</h2>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Selecione o Tipo de Documento:</label>
              <select 
                name="templateSelecionado" 
                value={formData.templateSelecionado} 
                onChange={handleInputChange}
                style={styles.input}
              >
                {Object.keys(templates).map((key) => (
                  <option key={key} value={key}>
                    {templates[key].nome}
                  </option>
                ))}
              </select>
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Upload do Timbre do Escritório (opcional):</label>
              <input 
                type="file" 
                accept="image/*" 
                onChange={handleTimbreUpload} 
                style={styles.fileInput}
              />
              {formData.timbrePrevisualizacao && (
                <div>
                  <p>Timbre carregado:</p>
                  <img 
                    src={formData.timbrePrevisualizacao} 
                    alt="Timbre do escritório" 
                    style={{ maxWidth: '300px', marginTop: '10px' }} 
                  />
                </div>
              )}
            </div>
          </div>
          
          <div style={styles.formSection}>
            <h2 style={styles.sectionTitle}>Dados do Cliente</h2>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Nome Completo:</label>
              <input
                type="text"
                name="nomeCliente"
                value={formData.nomeCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Nome completo do cliente"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Nacionalidade:</label>
              <input
                type="text"
                name="nacionalidadeCliente"
                value={formData.nacionalidadeCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Ex: brasileiro(a)"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Estado Civil:</label>
              <input
                type="text"
                name="estadoCivilCliente"
                value={formData.estadoCivilCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Ex: solteiro(a), casado(a)"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Profissão:</label>
              <input
                type="text"
                name="profissaoCliente"
                value={formData.profissaoCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Profissão do cliente"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>RG:</label>
              <input
                type="text"
                name="rgCliente"
                value={formData.rgCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Número do RG"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>CPF:</label>
              <input
                type="text"
                name="cpfCliente"
                value={formData.cpfCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="000.000.000-00"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Endereço Completo:</label>
              <input
                type="text"
                name="enderecoCliente"
                value={formData.enderecoCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Rua, número, complemento, bairro"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Cidade:</label>
              <input
                type="text"
                name="cidadeCliente"
                value={formData.cidadeCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Cidade"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Estado:</label>
              <input
                type="text"
                name="estadoCliente"
                value={formData.estadoCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="UF"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>CEP:</label>
              <input
                type="text"
                name="cepCliente"
                value={formData.cepCliente}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="00000-000"
              />
            </div>
          </div>
          
          <div style={styles.formSection}>
            <h2 style={styles.sectionTitle}>Dados do Advogado</h2>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Nome Completo:</label>
              <input
                type="text"
                name="nomeAdvogado"
                value={formData.nomeAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Nome completo do advogado"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Número da OAB:</label>
              <input
                type="text"
                name="numeroOAB"
                value={formData.numeroOAB}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Número da OAB"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Estado da OAB:</label>
              <input
                type="text"
                name="estadoAdvogado"
                value={formData.estadoAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="UF"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Endereço Profissional:</label>
              <input
                type="text"
                name="enderecoAdvogado"
                value={formData.enderecoAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Endereço completo do escritório"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Cidade:</label>
              <input
                type="text"
                name="cidadeAdvogado"
                value={formData.cidadeAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="Cidade"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Estado:</label>
              <input
                type="text"
                name="estadoEnderecoAdvogado"
                value={formData.estadoEnderecoAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="UF"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>CEP:</label>
              <input
                type="text"
                name="cepAdvogado"
                value={formData.cepAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="00000-000"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Email:</label>
              <input
                type="email"
                name="emailAdvogado"
                value={formData.emailAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="email@exemplo.com"
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Telefone:</label>
              <input
                type="text"
                name="telefoneAdvogado"
                value={formData.telefoneAdvogado}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="(00) 00000-0000"
              />
            </div>
          </div>
          
          <div style={styles.formSection}>
            <h2 style={styles.sectionTitle}>Dados do Processo</h2>
            
            {formData.templateSelecionado === 'contestacao' && (
              <div style={styles.formGroup}>
                <label style={styles.label}>Número do Processo:</label>
                <input
                  type="text"
                  name="numeroProcesso"
                  value={formData.numeroProcesso}
                  onChange={handleInputChange}
                  style={styles.input}
                  placeholder="Número do processo"
                />
              </div>
            )}
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Descrição dos Fatos:</label>
              <textarea
                name="descricaoFatos"
                value={formData.descricaoFatos}
                onChange={handleInputChange}
                style={{ ...styles.input, minHeight: '150px' }}
                placeholder="Descreva os fatos relevantes para o processo..."
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Pedidos:</label>
              <textarea
                name="pedidos"
                value={formData.pedidos}
                onChange={handleInputChange}
                style={{ ...styles.input, minHeight: '150px' }}
                placeholder="Liste os pedidos do processo..."
              />
            </div>
            
            <div style={styles.formGroup}>
              <label style={styles.label}>Valor da Causa:</label>
              <input
                type="text"
                name="valorCausa"
                value={formData.valorCausa}
                onChange={handleInputChange}
                style={styles.input}
                placeholder="0.000,00"
              />
            </div>
          </div>
          
          <div style={styles.buttonContainer}>
            <button onClick={gerarDocumento} style={styles.button}>
              Gerar Documento
            </button>
          </div>
        </div>
      ) : (
        <div>
          <div style={styles.buttonContainer}>
            <button onClick={handlePrint} style={styles.button}>
              Imprimir
            </button>
            <button onClick={exportarComoDoc} style={styles.button}>
              Exportar como DOC
            </button>
            <button onClick={exportarComoPdf} style={styles.button}>
              Exportar como PDF
            </button>
            <button onClick={voltarParaFormulario} style={styles.button}>
              Voltar ao Formulário
            </button>
          </div>
          
          <div ref={componenteImpressao}>
            <div 
              dangerouslySetInnerHTML={{ 
                __html: templates[formData.templateSelecionado].gerarDocumento(formData) 
              }} 
              style={styles.documentPreview}
            />
          </div>
        </div>
      )}
    </div>
  );
}

export default App;
