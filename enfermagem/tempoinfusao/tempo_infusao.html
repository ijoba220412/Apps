<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente de Infusão Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .slide-in { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Cores Específicas da Dessensibilização */
        .sol-1 { background-color: #FEF3C7; color: #92400E; border-left: 4px solid #F59E0B; }
        .sol-2 { background-color: #DBEAFE; color: #1E40AF; border-left: 4px solid #3B82F6; }
        .sol-3 { background-color: #F3E8FF; color: #6B21A8; border-left: 4px solid #A855F7; }
        
        /* Controle de Abas */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 pb-20">

    <!-- Header Fixo -->
    <header class="bg-white shadow-md sticky top-0 z-20">
        <div class="bg-slate-800 text-white p-3 text-center">
            <h1 class="font-bold text-lg flex justify-center items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                Enfermagem Pro
            </h1>
        </div>
        
        <!-- Navegação por Abas -->
        <nav class="flex text-sm font-medium text-center text-slate-500 border-b border-slate-200">
            <button onclick="switchTab('simple')" id="tab-btn-simple" class="w-1/2 p-4 border-b-2 border-blue-600 text-blue-600 active bg-blue-50 hover:bg-blue-50 transition-all flex justify-center gap-2 items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                Calc. Padrão
            </button>
            <button onclick="switchTab('desens')" id="tab-btn-desens" class="w-1/2 p-4 border-b-2 border-transparent hover:text-slate-600 hover:bg-slate-50 transition-all flex justify-center gap-2 items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                Dessensibilização
            </button>
        </nav>
    </header>

    <main class="max-w-md mx-auto p-4">

        <!-- ========================================== -->
        <!-- ABA 1: CALCULADORA SIMPLES (PADRÃO)        -->
        <!-- ========================================== -->
        <div id="tab-simple" class="tab-content active space-y-6">
            
            <!-- Configuração Hora Padrão -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-2">
                    <label class="text-xs font-bold text-slate-500 uppercase">Início da Infusão</label>
                    <button onclick="resetSimple()" class="text-[10px] text-red-500 font-bold uppercase border border-red-200 px-2 py-1 rounded hover:bg-red-50">Limpar</button>
                </div>
                <div class="flex items-center gap-4">
                    <input type="time" id="simpleStartTime" onchange="renderSimpleTimeline()" class="flex-1 text-3xl font-bold text-blue-600 bg-slate-50 border border-slate-300 rounded-lg p-2 text-center focus:ring-2 focus:ring-blue-500 outline-none">
                    <div class="text-right">
                        <p class="text-[10px] text-slate-500 uppercase">Término</p>
                        <p id="simpleEndTime" class="text-xl font-bold text-slate-700">--:--</p>
                    </div>
                </div>
            </div>

            <!-- Lista Simples -->
            <div id="simpleTimeline" class="space-y-3 relative border-l-2 border-slate-200 ml-3 pl-4">
                <!-- Itens Padrão aqui -->
            </div>
            
            <!-- Estado Vazio Simples -->
            <div id="simpleEmpty" class="text-center py-8 text-slate-400 border-2 border-dashed rounded-lg">
                <p>Nenhum item adicionado</p>
            </div>

            <!-- Form Simples -->
            <form onsubmit="addSimpleMed(event)" class="bg-white p-4 rounded-xl shadow-md border border-slate-200">
                <h3 class="text-sm font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs">+</span> Adicionar Etapa
                </h3>
                <div class="space-y-3">
                    <input type="text" id="simpleMedName" placeholder="Nome (Ex: Soro, Dipirona)" class="w-full p-2 border rounded text-sm focus:border-blue-500 outline-none" required>
                    
                    <div>
                        <div class="flex gap-2 mb-2 overflow-x-auto scrollbar-hide">
                            <button type="button" onclick="setSimpleDuration(15)" class="px-3 py-1 text-xs bg-slate-100 rounded-full hover:bg-slate-200">15m</button>
                            <button type="button" onclick="setSimpleDuration(30)" class="px-3 py-1 text-xs bg-slate-100 rounded-full hover:bg-slate-200">30m</button>
                            <button type="button" onclick="setSimpleDuration(60)" class="px-3 py-1 text-xs bg-slate-100 rounded-full hover:bg-slate-200">1h</button>
                            <button type="button" onclick="setSimpleDuration(120)" class="px-3 py-1 text-xs bg-slate-100 rounded-full hover:bg-slate-200">2h</button>
                        </div>
                        <div class="flex items-center border rounded overflow-hidden">
                            <input type="number" id="simpleMedDuration" placeholder="Duração" class="w-full p-2 outline-none text-sm" required>
                            <span class="bg-slate-50 px-3 py-2 text-xs text-slate-500 border-l">min</span>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-bold shadow-sm">Adicionar</button>
                </div>
            </form>
        </div>

        <!-- ========================================== -->
        <!-- ABA 2: DESSENSIBILIZAÇÃO (PROTOCOLO 12)    -->
        <!-- ========================================== -->
        <div id="tab-desens" class="tab-content space-y-6">
            
            <!-- Botão Mágico -->
            <button onclick="loadDesensProtocol()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white p-4 rounded-xl shadow-lg flex items-center justify-between group transition-all">
                <div class="text-left">
                    <p class="font-bold text-lg">Carregar Protocolo 12 Etapas</p>
                    <p class="text-xs text-purple-100 opacity-90">Auto-preencher Carboplatina/Outros</p>
                </div>
                <div class="bg-white/20 p-2 rounded-full group-active:scale-90 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                </div>
            </button>

            <!-- Configuração Hora Dessensibilização -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-purple-100">
                <div class="flex justify-between items-center mb-2">
                    <label class="text-xs font-bold text-purple-700 uppercase">Início do Protocolo</label>
                    <button onclick="resetDesens()" class="text-[10px] text-red-500 font-bold uppercase border border-red-200 px-2 py-1 rounded hover:bg-red-50">Limpar</button>
                </div>
                <div class="flex items-center gap-4">
                    <input type="time" id="desensStartTime" onchange="renderDesensTimeline()" class="flex-1 text-3xl font-bold text-purple-700 bg-purple-50 border border-purple-200 rounded-lg p-2 text-center focus:ring-2 focus:ring-purple-500 outline-none">
                    <div class="text-right">
                        <p class="text-[10px] text-slate-500 uppercase">Término</p>
                        <p id="desensEndTime" class="text-xl font-bold text-slate-700">--:--</p>
                    </div>
                </div>
            </div>

            <!-- Lista Dessensibilização -->
            <div id="desensTimeline" class="space-y-3">
                <!-- Itens Complexos aqui -->
            </div>

            <!-- Estado Vazio Dessens -->
            <div id="desensEmpty" class="text-center py-8 text-slate-400 border-2 border-dashed border-purple-200 bg-purple-50/50 rounded-lg">
                <p>Nenhuma etapa configurada</p>
                <p class="text-xs">Toque no botão roxo acima para iniciar</p>
            </div>
            
            <!-- Legenda -->
            <div class="flex justify-center gap-3 text-[10px] text-slate-500 bg-white p-2 rounded-lg border border-slate-100">
                <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-[#FEF3C7] border border-[#F59E0B]"></span> Solução 1</span>
                <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-[#DBEAFE] border border-[#3B82F6]"></span> Solução 2</span>
                <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-[#F3E8FF] border border-[#A855F7]"></span> Solução 3</span>
            </div>
        </div>

    </main>

    <script>
        // === UTILITÁRIOS ===
        function addMinutes(timeStr, minsToAdd) {
            if (!timeStr) return '';
            const [hours, minutes] = timeStr.split(':').map(Number);
            const date = new Date();
            date.setHours(hours);
            date.setMinutes(minutes + minsToAdd);
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function getCurrentTime() {
            const now = new Date();
            return `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        }

        // === LÓGICA DAS ABAS ===
        function switchTab(tabName) {
            // Esconde todas as abas
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            // Remove active dos botões
            document.getElementById('tab-btn-simple').className = "w-1/2 p-4 border-b-2 border-transparent hover:text-slate-600 hover:bg-slate-50 transition-all flex justify-center gap-2 items-center text-slate-500";
            document.getElementById('tab-btn-desens').className = "w-1/2 p-4 border-b-2 border-transparent hover:text-slate-600 hover:bg-slate-50 transition-all flex justify-center gap-2 items-center text-slate-500";

            // Ativa a aba correta e estiliza o botão
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            const activeBtnClass = "w-1/2 p-4 border-b-2 font-bold transition-all flex justify-center gap-2 items-center";
            if(tabName === 'simple') {
                document.getElementById('tab-btn-simple').className = `${activeBtnClass} border-blue-600 text-blue-600 bg-blue-50`;
            } else {
                document.getElementById('tab-btn-desens').className = `${activeBtnClass} border-purple-600 text-purple-600 bg-purple-50`;
            }
        }

        // === LÓGICA ABA 1: SIMPLES ===
        let simpleMeds = [];

        function initSimple() {
            document.getElementById('simpleStartTime').value = getCurrentTime();
            renderSimpleTimeline();
        }

        function addSimpleMed(e) {
            e.preventDefault();
            const name = document.getElementById('simpleMedName').value;
            const duration = parseInt(document.getElementById('simpleMedDuration').value);
            
            if(name && duration) {
                simpleMeds.push({ id: Date.now(), name, duration });
                document.getElementById('simpleMedName').value = '';
                document.getElementById('simpleMedDuration').value = '';
                renderSimpleTimeline();
            }
        }

        function setSimpleDuration(min) {
            document.getElementById('simpleMedDuration').value = min;
        }

        function removeSimpleMed(id) {
            simpleMeds = simpleMeds.filter(m => m.id !== id);
            renderSimpleTimeline();
        }

        function resetSimple() {
            if(confirm('Limpar lista padrão?')) {
                simpleMeds = [];
                renderSimpleTimeline();
            }
        }

        function renderSimpleTimeline() {
            const container = document.getElementById('simpleTimeline');
            const startTime = document.getElementById('simpleStartTime').value;
            const empty = document.getElementById('simpleEmpty');
            
            container.innerHTML = '';
            
            if(simpleMeds.length === 0) {
                empty.style.display = 'block';
                document.getElementById('simpleEndTime').innerText = startTime;
                return;
            }
            empty.style.display = 'none';

            let currentStart = startTime;

            simpleMeds.forEach(med => {
                const end = addMinutes(currentStart, med.duration);
                
                // Formatação bonita de tempo
                let durTxt = `${med.duration}m`;
                if(med.duration >= 60) durTxt = `${Math.floor(med.duration/60)}h ${med.duration%60}m`.replace(' 0m', '');

                container.innerHTML += `
                    <div class="relative bg-white p-3 rounded-lg shadow-sm mb-3 border border-slate-100 slide-in">
                        <div class="absolute -left-[23px] top-4 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></div>
                        <div class="flex justify-between items-start mb-1">
                            <span class="font-bold text-slate-700">${med.name}</span>
                            <button onclick="removeSimpleMed(${med.id})" class="text-slate-300 hover:text-red-500">&times;</button>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <div class="text-green-600 font-mono font-bold">${currentStart}</div>
                            <div class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded-full font-bold mx-2 flex-1 text-center">${durTxt}</div>
                            <div class="text-red-600 font-mono font-bold">${end}</div>
                        </div>
                    </div>
                `;
                currentStart = end;
            });
            document.getElementById('simpleEndTime').innerText = currentStart;
        }

        // === LÓGICA ABA 2: DESSENSIBILIZAÇÃO ===
        let desensMeds = [];
        
        // Dados fixos do protocolo 12 etapas
        const protocolData = [
            { sol: '1', rate: 2.0, duration: 15, step: 1 },
            { sol: '1', rate: 5.0, duration: 15, step: 2 },
            { sol: '1', rate: 10.0, duration: 15, step: 3 },
            { sol: '1', rate: 20.0, duration: 15, step: 4 },
            { sol: '2', rate: 5.0, duration: 15, step: 5 },
            { sol: '2', rate: 10.0, duration: 15, step: 6 },
            { sol: '2', rate: 20.0, duration: 15, step: 7 },
            { sol: '2', rate: 40.0, duration: 15, step: 8 },
            { sol: '3', rate: 10.0, duration: 15, step: 9 },
            { sol: '3', rate: 20.0, duration: 15, step: 10 },
            { sol: '3', rate: 40.0, duration: 15, step: 11 },
            { sol: '3', rate: 80.0, duration: 174, step: 12, name: 'Restante' }
        ];

        function initDesens() {
            document.getElementById('desensStartTime').value = getCurrentTime();
            renderDesensTimeline();
        }

        function loadDesensProtocol() {
            desensMeds = JSON.parse(JSON.stringify(protocolData));
            
            if(confirm("Incluir Pré-Medicações (30 min) antes?")) {
                desensMeds.unshift({
                    sol: 'Pré',
                    rate: 0,
                    duration: 30,
                    name: 'Pré-Medicações',
                    step: 0
                });
            }
            renderDesensTimeline();
        }

        function resetDesens() {
            if(confirm('Limpar protocolo de dessensibilização?')) {
                desensMeds = [];
                renderDesensTimeline();
            }
        }

        function removeDesensMed(index) {
            desensMeds.splice(index, 1);
            renderDesensTimeline();
        }

        function renderDesensTimeline() {
            const container = document.getElementById('desensTimeline');
            const startTime = document.getElementById('desensStartTime').value;
            const empty = document.getElementById('desensEmpty');

            container.innerHTML = '';

            if(desensMeds.length === 0) {
                empty.style.display = 'block';
                document.getElementById('desensEndTime').innerText = startTime;
                return;
            }
            empty.style.display = 'none';

            let currentStart = startTime;

            desensMeds.forEach((item, idx) => {
                const end = addMinutes(currentStart, item.duration);
                
                let solClass = '';
                if(item.sol === '1') solClass = 'sol-1';
                else if(item.sol === '2') solClass = 'sol-2';
                else if(item.sol === '3') solClass = 'sol-3';
                else solClass = 'bg-slate-100 border-l-4 border-slate-400 text-slate-600';

                const title = item.name ? item.name : `Etapa ${item.step}`;
                const detail = item.rate > 0 ? `${item.rate} mL/h` : 'IV/Bolus';

                container.innerHTML += `
                    <div class="rounded-lg shadow-sm p-3 flex justify-between items-center slide-in mb-2 ${solClass}">
                        <div class="text-left w-16 border-r border-black/10 pr-2">
                            <div class="text-[10px] opacity-70 uppercase">Início</div>
                            <div class="font-bold text-lg leading-none">${currentStart}</div>
                        </div>
                        
                        <div class="flex-1 px-3">
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-bold uppercase bg-white/50 px-1 rounded">Sol. ${item.sol}</span>
                                <span class="font-bold text-sm">${title}</span>
                            </div>
                            <div class="flex gap-3 text-xs opacity-90 mt-1">
                                <span class="flex items-center gap-1 bg-white/30 px-1.5 rounded"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 2v20"/></svg> ${detail}</span>
                                <span class="flex items-center gap-1 bg-white/30 px-1.5 rounded"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"/></svg> ${item.duration}m</span>
                            </div>
                        </div>

                        <div class="text-right w-16 pl-2 border-l border-black/10">
                            <div class="text-[10px] opacity-70 uppercase">Fim</div>
                            <div class="font-bold text-lg leading-none opacity-80">${end}</div>
                            <button onclick="removeDesensMed(${idx})" class="mt-1 text-[10px] hover:text-red-700 underline">remover</button>
                        </div>
                    </div>
                `;
                currentStart = end;
            });
            document.getElementById('desensEndTime').innerText = currentStart;
        }

        // Inicialização
        initSimple();
        initDesens();
    </script>
</body>
</html>

