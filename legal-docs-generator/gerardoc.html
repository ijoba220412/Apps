<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Documentos Jurídicos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- jsPDF para exportação PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- html2pdf para exportação PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- docx para exportação Word -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    
    <!-- FileSaver.js para salvar arquivos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- Estilos -->
    <style>
        body { background-color: #f8f9fa; }
        .preview-container { font-family: 'Times New Roman', serif; font-size: 12pt; padding: 30px; }
        #documentPreview { padding: 40px; background-color: white; min-height: 29.7cm; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center">Gerador de Documentos Jurídicos</h2>
        
        <form id="petitionForm">
            <div class="mb-3">
                <label class="form-label">Nome do Reclamante</label>
                <input type="text" class="form-control" id="reclamante_nome" name="RECLAMANTE_NOME" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Cidade</label>
                <input type="text" class="form-control" id="cidade_uf" name="CIDADE_UF" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Descrição</label>
                <textarea class="form-control" id="descricao" name="DESCRICAO" rows="3" required></textarea>
            </div>
            
            <button type="button" id="generateBtn" class="btn btn-primary">Gerar Documento</button>
        </form>
        
        <hr>

        <h4>Visualização do Documento</h4>
        <div id="documentPreview" class="preview-container">
            <p class="text-center text-muted">Preencha o formulário e clique em "Gerar Documento".</p>
        </div>

        <hr>

        <button id="exportPdfBtn" class="btn btn-danger">Exportar para PDF</button>
        <button id="exportDocBtn" class="btn btn-success">Exportar para DOC</button>
    </div>

    <script>
        $(document).ready(function() {
            $('#generateBtn').click(function() {
                if (!$('#petitionForm')[0].checkValidity()) {
                    $('#petitionForm')[0].reportValidity();
                    return;
                }
                generateDocument();
            });

            $('#exportPdfBtn').click(function() {
                const element = document.getElementById('documentPreview');
                html2pdf().set({ filename: 'documento.pdf', jsPDF: { format: 'a4' } }).from(element).save();
            });

            $('#exportDocBtn').click(function() {
                const content = document.getElementById('documentPreview').innerText;
                const doc = new docx.Document({
                    sections: [{ children: [new docx.Paragraph(content)] }]
                });
                docx.Packer.toBlob(doc).then(blob => saveAs(blob, 'documento.doc'));
            });
        });

        function generateDocument() {
            let formData = new FormData(document.getElementById('petitionForm'));
            let template = `
                <h3>Documento Jurídico</h3>
                <p><strong>Nome:</strong> {{RECLAMANTE_NOME}}</p>
                <p><strong>Cidade:</strong> {{CIDADE_UF}}</p>
                <p><strong>Descrição:</strong> {{DESCRICAO}}</p>
            `;

            formData.forEach((value, key) => {
                let capitalizedValue = value.replace(/\b\w/g, char => char.toUpperCase());
                template = template.replace(new RegExp('{{' + key + '}}', 'g'), capitalizedValue);
            });

            document.getElementById('documentPreview').innerHTML = template;
        }
    </script>
</body>
</html>
