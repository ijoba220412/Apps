<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Procuração</title>
    <style>
        /* ... (mantenha os estilos anteriores) ... */
        .error { border: 2px solid red !important }
        .error-message { color: red; font-size: 0.9em }
    </style>
    <!-- Adicione estas dependências -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
</head>
<body>
    <div class="form-container">
        <h1>Gerador de Procuração</h1>
        
        <form id="docForm">
            <!-- Campos anteriores com máscaras -->
            <div class="grid">
                <div class="form-group">
                    <label>CPF:</label>
                    <input type="text" name="CPF" required 
                           data-mask="000.000.000-00"
                           data-cpf-validation>
                    <div class="error-message" id="cpf-error"></div>
                </div>
                
                <div class="form-group">
                    <label>RG:</label>
                    <input type="text" name="RG" required 
                           data-mask="00.000.000-AA">
                </div>
            </div>

            <div class="form-group">
                <label>Número da OAB:</label>
                <input type="text" name="OAB" required 
                       data-mask="000000/AA"
                       data-oab-validation>
                <div class="error-message" id="oab-error"></div>
            </div>

            <!-- ... (mantenha os outros campos) ... -->

            <button type="submit">Gerar Documento</button>
        </form>
    </div>

    <script>
        // Máscaras
        $(document).ready(function() {
            $('[data-mask]').each(function() {
                $(this).mask($(this).data('mask'));
            });
        });

        // Validação completa de CPF
        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            
            if (cpf.length !== 11 || 
                /^(\d)\1{10}$/.test(cpf)) return false;

            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let resto = 11 - (soma % 11);
            let digito1 = resto > 9 ? 0 : resto;

            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            resto = 11 - (soma % 11);
            let digito2 = resto > 9 ? 0 : resto;

            return digito1 === parseInt(cpf.charAt(9)) && 
                   digito2 === parseInt(cpf.charAt(10));
        }

        // Validação de OAB
        function validarOAB(oab) {
            const partes = oab.split('/');
            return partes.length === 2 && 
                   partes[0].length === 6 &&
                   /^\d+$/.test(partes[0]) &&
                   partes[1].length === 2 &&
                   /^[A-Za-z]{2}$/.test(partes[1]);
        }

        // Validação em tempo real
        document.querySelector('[data-cpf-validation]').addEventListener('blur', function() {
            const valido = validarCPF(this.value);
            this.classList.toggle('error', !valido);
            document.getElementById('cpf-error').textContent = 
                valido ? '' : 'CPF inválido!';
        });

        document.querySelector('[data-oab-validation]').addEventListener('blur', function() {
            const valido = validarOAB(this.value);
            this.classList.toggle('error', !valido);
            document.getElementById('oab-error').textContent = 
                valido ? '' : 'Formato inválido (Ex: 123456/SP)';
        });

        // Confirmação e envio
        document.getElementById('docForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (!validarCPF(this.CPF.value) {
                alert('Por favor, corrija o CPF!');
                return;
            }

            if (!validarOAB(this.OAB.value)) {
                alert('Por favor, corrija a OAB!');
                return;
            }

            if (confirm('Confirma os dados para gerar o documento?')) {
                // Salvar dados localmente
                const formData = {};
                Array.from(this.elements).forEach(el => {
                    if (el.name) formData[el.name] = el.value;
                });
                localStorage.setItem('ultimoDocumento', JSON.stringify(formData));
                
                // Redirecionar para o template
                window.open(`./templates/procuracao.html?${new URLSearchParams(formData)}`, '_blank');
            }
        });

        // Carregar último rascunho
        window.onload = () => {
            const savedData = localStorage.getItem('ultimoDocumento');
            if (savedData) {
                const data = JSON.parse(savedData);
                Array.from(document.docForm.elements).forEach(el => {
                    if (el.name && data[el.name]) el.value = data[el.name];
                });
            }
        };
    </script>
</body>
</html>
