<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Documento Gerado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .document-container {
            background-color: white;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 210mm;
            min-height: 297mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
        }
        .btn-export { margin: 1rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between my-3">
            <a href="../index.html" class="btn btn-secondary">Página Inicial</a>
            <a href="./gerardoc.html" class="btn btn-outline-primary">Editar Novamente</a>
        </div>

        <div class="document-container" id="documentContent">
            <!-- Conteúdo será preenchido via JavaScript -->
        </div>

        <div class="text-center">
            <button onclick="exportPDF()" class="btn btn-success btn-export">Exportar PDF</button>
            <button onclick="exportDOC()" class="btn btn-primary btn-export">Exportar Word</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // Função original estável
        const dados = JSON.parse(localStorage.getItem('dadosDocumento'));
        
        function carregarTemplate() {
            fetch('templates/inicial_trab.txt')
                .then(response => response.text())
                .then(template => {
                    let conteudo = template;
                    for (const [chave, valor] of Object.entries(dados)) {
                        conteudo = conteudo.replace(new RegExp(`{{${chave}}}`, 'g'), valor);
                    }
                    document.getElementById('documentContent').innerHTML = 
                        conteudo.replace(/\n/g, '<br>').replace(/\s{4,}/g, '<br><br>');
                });
        }

        function exportPDF() {
            const element = document.getElementById('documentContent');
            html2pdf().from(element).save();
        }

        function exportDOC() {
            const content = document.getElementById('documentContent').innerHTML;
            const blob = new Blob([content], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'documento-gerado.doc';
            link.click();
        }

        window.onload = carregarTemplate;
    </script>
</body>
</html>


<!-- Adicione este botão abaixo dos botões existentes -->
<button onclick="addTimbrado()" class="btn btn-warning btn-export">Adicionar Timbrado</button>

<script>
// Nova função para timbrado seguro
function addTimbrado() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = function(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            document.getElementById('documentContent').style.backgroundImage = 
                `url(${e.target.result})`;
            document.getElementById('documentContent').style.backgroundSize = 'cover';
            document.getElementById('documentContent').style.backgroundRepeat = 'no-repeat';
        };
        
        reader.readAsDataURL(file);
    };
    input.click();
}
</script>