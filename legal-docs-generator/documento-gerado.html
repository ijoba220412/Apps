<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Documento Gerado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .document-container {
            background-color: white;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 210mm;
            min-height: 297mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .btn-export { margin: 1rem; }

.document-container {
    background-color: rgba(255, 255, 255, 0.9);
    mix-blend-mode: lighten;
    padding: 4rem 3rem;
    min-height: 297mm;
}

    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between my-3">
            <a href="../index.html" class="btn btn-secondary">Página Inicial</a>
            <a href="./gerardoc.html" class="btn btn-outline-primary">Editar Novamente</a>
        </div>

        <div class="document-container" id="documentContent">
            <!-- O conteúdo será preenchido via JavaScript -->
        </div>

        <div class="text-center">
            <button onclick="exportPDF()" class="btn btn-success btn-export">Exportar PDF</button>
            <button onclick="exportDOC()" class="btn btn-primary btn-export">Exportar Word</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>

// No início do script
function carregarTemplate() {
    // Carregar timbrado do LocalStorage
    const timbradoData = localStorage.getItem('timbradoData');
    
    if(timbradoData) {
        document.getElementById('documentContent').style.background = 
            `url(${timbradoData}) no-repeat center center`;
        document.getElementById('documentContent').style.backgroundSize = 'cover';
    }

    // Restante do código...
}

        const dados = JSON.parse(localStorage.getItem('dadosDocumento'));
        
        function carregarTemplate() {
            fetch('templates/inicial_trab.txt')
                .then(response => response.text())
                .then(template => {
                    let conteudo = template;
                    for (const [chave, valor] of Object.entries(dados)) {
                        conteudo = conteudo.replace(new RegExp(`{{${chave}}}`, 'g'), valor);
                    }
                    document.getElementById('documentContent').innerHTML = 
                        conteudo.replace(/\n/g, '<br>').replace(/\s{4,}/g, '<br><br>');
                });
        }


        function exportDOC() {
            const content = document.getElementById('documentContent').innerHTML;
            const blob = new Blob([content], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'documento-gerado.doc';
            link.click();
        }

        window.onload = carregarTemplate;

function exportPDF() {
    const element = document.getElementById('documentContent');
    const opt = {
        margin: [60, 40],
        filename: 'documento-gerado.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2,
            useCORS: true,
            background: '#ffffff',
            logging: true
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait',
            putOnlyUsedFonts: true
        }
    };
    
    // Forçar recarregamento do background
    const originalBackground = element.style.background;
    element.style.background = 'none';
    
    html2pdf().set(opt).from(element).save().then(() => {
        element.style.background = originalBackground; // Restaurar após exportação
    });
}

    </script>
</body>
</html>
